'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_axios=require('axios'),_axios2=_interopRequireDefault(_axios),_pluralize=require('pluralize'),_pluralize2=_interopRequireDefault(_pluralize),_lodash=require('lodash');Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Service=function(){function a(){_classCallCheck(this,a),this._http=_axios2.default,this.parent_id=null,this.config={origin:window.location.origin,prefix:'',endpoint:(0,_pluralize2.default)((0,_lodash.kebabCase)(this.getClassName())).toLowerCase()}}return _createClass(a,[{key:'getClassName',value:function getClassName(){return this.constructor.name}},{key:'buildUrl',value:function buildUrl(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'',c=this.buildPrefix(),d=this.config.origin,e=this.config.endpoint;return this.sanitizeUrl(d+'/'+c+'/'+e+'/'+b)}},{key:'buildPrefix',value:function buildPrefix(){return this.parent_id?this.config.prefix+'/'+this.parent_id:this.config.prefix}},{key:'sanitizeUrl',value:function sanitizeUrl(b){return b.replace(/([^:])(\/\/+)/g,'$1/')}},{key:'beforeFind',value:function beforeFind(b){return b}},{key:'found',value:function found(b){return b}},{key:'beforeFetch',value:function beforeFetch(b){return b}},{key:'fetched',value:function fetched(b){return b}},{key:'beforeCreate',value:function beforeCreate(b){return b}},{key:'created',value:function created(b){return b}},{key:'beforeUpdate',value:function beforeUpdate(b){return b}},{key:'updated',value:function updated(b){return b}},{key:'beforeDelete',value:function beforeDelete(b){return b}},{key:'deleted',value:function deleted(b){return b}},{key:'getResource',value:function getResource(){var f=this,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.parent_id=e;var b=this.buildUrl(),c=new Promise(function(g,h){f._http.get(b,{params:d}).then(function(j){g(f.fetched(j))}).catch(function(j){h(j)})});return c}},{key:'createResource',value:function createResource(b){var f=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!b){throw'data is needed'}this.parent_id=e;var c=this.buildUrl(),d=new Promise(function(g,h){f._http.post(c,b).then(function(j){g(f.created(j))}).catch(function(j){h(j)})});return d}},{key:'findResource',value:function findResource(b){var g=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!b){throw'ID is needed'}this.parent_id=f;var c=this.buildUrl(b),d=new Promise(function(h,j){g._http.get(c,{params:e}).then(function(k){h(g.found(k))}).catch(function(k){j(k)})});return d}},{key:'updateResource',value:function updateResource(b,c){var g=this,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.parent_id=f;var d=this.buildUrl(b),e=new Promise(function(h,j){g._http.put(d,c).then(function(k){h(g.updated(k))}).catch(function(k){j(k)})});return e}},{key:'deleteResource',value:function deleteResource(b){var f=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!b){throw'ID to delete is needed'}this.parent_id=e;var c=this.buildUrl(b),d=new Promise(function(g,h){f._http.delete(c).then(function(j){g(f.deleted(j))}).catch(function(j){h(j)})});return d}},{key:'handleRequest',value:function handleRequest(b,c){var k=this,d=b.method,e=b.route,f=b.payload,g=b.urlParams;try{d=d.toLowerCase()}catch(l){console.error('define a valid method, '+d+' received')}var h=_extends({},g),j=new Promise(function(l,m){var n;'get'==d?n=k._http[d](e,{params:h}):'put'==d||'post'==d||'patch'==d?n=k._http[d](e,f):'delete'==d&&(n=k._http[d](e)),n.then(function(o){c&&k[c]&&(o=k[c](o)),l(o)}).catch(function(o){m(o)})});return j}}],[{key:'newInstance',value:function newInstance(){return new a}},{key:'get',value:function get(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=arguments[1],d=new a;return b=d.beforeFetch(b),d.getResource(b,c)}},{key:'create',value:function create(b,c){var d=new a;return b=d.beforeCreate(b),d.createResource(b,c)}},{key:'find',value:function find(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=arguments[2],e=new a;return b=e.beforeFind(b),e.findResource(b,c,d)}},{key:'delete',value:function _delete(b,c){var d=new a;return b=d.beforeDelete(b),d.deleteResource(b,c)}},{key:'update',value:function update(b,c,d){var e=new a;return c=e.beforeUpdate(c),e.updateResource(b,c,d)}}]),a}();exports.default=Service;
